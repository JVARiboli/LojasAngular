<h2 class="mb-3">Lojas</h2>

@if (loading) {<div class="alert alert-info">Carregando...</div>}
@if (erro) {<div class="alert alert-danger">{{ erro }}</div>}
@if (sucesso) {<div class="alert alert-success">{{ sucesso }}</div>}

<div class="card mb-4">
  <div class="card-header">
    <h3>Cadastrar Nova Loja</h3>
  </div>
  <div class="card-body">
    <div class="row g-3">
      <div class="col-md-6">
        <label for="nomeLoja" class="form-label">Nome da Loja</label>
        <input id="nomeLoja" class="form-control" [(ngModel)]="novaLoja.nome" placeholder="Ex: Loja Central">
      </div>
      <div class="col-md-6">
        <label for="cnpjLoja" class="form-label">CNPJ</label>
        <input id="cnpjLoja" class="form-control" [(ngModel)]="novaLoja.cnpj" placeholder="00.000.000/0000-00">
      </div>
      <div class="col-12">
        <label for="enderecoLoja" class="form-label">Endereço</label>
        <input id="enderecoLoja" class="form-control" [(ngModel)]="novaLoja.endereco" placeholder="Ex: Rua Principal, 123">
      </div>
      <div class="col-12">
        <button class="btn btn-primary" (click)="adicionarLoja()">Adicionar Loja</button>
      </div>
    </div>
  </div>
</div>

<h4>Lojas Cadastradas</h4>
<ul class="list-group">
  @for (loja of lojas; track loja.id) {
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <div>
        <strong>{{ loja.nome }}</strong> (CNPJ: {{ loja.cnpj }})
        <br>
        <small>{{ loja.endereco }}</small>
      </div>
      <div class="btn-group gap-2">
        <button class="btn btn-sm btn-warning" (click)="iniciarEdicao(loja)" data-bs-toggle="modal" data-bs-target="#editLojaModal">
          Editar
        </button>
        <button class="btn btn-sm btn-outline-danger" (click)="removerLoja(loja.id)">
          Remover
        </button>
      </div>
    </li>
  } @empty {
    <li class="list-group-item text-center">Nenhuma loja cadastrada.</li>
  }
</ul>

<div class="modal fade" id="editLojaModal" tabindex="-1">
  <div class="modal-dialog">
    @if(lojaEmEdicao) {
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Editar Loja: {{ lojaEmEdicao.nome }}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Nome</label>
            <input class="form-control" [(ngModel)]="lojaEmEdicao.nome">
          </div>
          <div class="mb-3">
            <label class="form-label">CNPJ</label>
            <input class="form-control" [(ngModel)]="lojaEmEdicao.cnpj">
          </div>
          <div class="mb-3">
            <label class="form-label">Endereço</label>
            <input class="form-control" [(ngModel)]="lojaEmEdicao.endereco">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-primary" (click)="salvarEdicao()" data-bs-dismiss="modal">Salvar Alterações</button>
        </div>
      </div>
    }
  </div>
</div>